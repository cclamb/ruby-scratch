#!/usr/bin/env ruby

require 'socket'
require 'aws-sdk'
require 'net/https'
require 'uri'
require 'yaml'


hostname = Socket.gethostname

if ARGF.argv.size > 0
  puts "Starting spinner on #{hostname}, ARGF: #{ARGF.argv}.\n"
else
  puts "Starting spinner on #{hostname}."
end

url = ARGF.argv[0]
uri = URI.parse url
http = Net::HTTP.new uri.host, uri.port
http.use_ssl = true
http.verify_mode = OpenSSL::SSL::VERIFY_NONE
request = Net::HTTP::Get.new uri.request_uri
response = http.request request

ctx = YAML::load response.body
puts ctx[hostname].inspect

Process::daemon true, false

continue = true
cnt = 0

while continue
	sleep 5
	cnt += 1
	break if cnt > 5
end
